<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Block Blaster - Improved</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=VT323&display=swap");

    * {
      box-sizing: border-box;
      font-family: "VT323", monospace;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      background: black;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    .game {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at center, #000 60%, #111 100%);
      position: relative;
      overflow: hidden;
      flex-direction: column;
      padding: 10px;
      color: white;
      user-select: none;
    }

    .canvas-holder {
      width: 100%;
      max-width: 600px;
      aspect-ratio: 1 / 1;
      border: 4px solid #444;
      border-radius: 20px;
      box-shadow: 0 0 30px #0f0;
      background-color: black;
      position: relative;
      touch-action: none; /* Prevent default gestures */
    }

    .game p {
      position: absolute;
      color: #fff;
      top: 10px;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: 24px;
      z-index: 10;
      text-shadow: 0 0 5px lime;
      pointer-events: none;
    }

    .scoreboard {
      width: 100%;
      max-width: 600px;
      display: flex;
      justify-content: space-between;
      margin: 10px 0 15px 0;
      font-size: 20px;
      text-shadow: 0 0 5px lime;
      user-select: none;
    }

    button#play-button {
      background: #61dafb;
      border: none;
      border-radius: 12px;
      padding: 15px 40px;
      font-size: 22px;
      cursor: pointer;
      color: #282c34;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(97, 218, 251, 0.6);
      transition: background 0.3s ease;
      margin-top: 10px;
      user-select: none;
    }
    button#play-button:hover {
      background: #21a1f1;
    }

    .extra-screen {
      position: absolute;
      width: 100%;
      max-width: 600px;
      aspect-ratio: 1 / 1;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      border-radius: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 20;
      flex-direction: column;
      color: lime;
      text-align: center;
      user-select: none;
    }

    .extra-screen.hide {
      display: none;
    }

    .extra-screen#lose-title {
      border: 2px solid red;
      box-shadow: 0 0 20px red;
    }

    .extra-screen h1 {
      font-size: 50px;
      text-shadow: 0 0 10px lime;
    }

    .extra-screen p {
      font-size: 20px;
      margin-top: 10px;
      text-shadow: 0 0 10px lime;
    }

    .extra-screen span.hide {
      display: none;
    }

    /* Responsive text */
    @media screen and (max-width: 400px) {
      .game p {
        font-size: 18px;
      }

      .extra-screen h1 {
        font-size: 36px;
      }

      .extra-screen p {
        font-size: 16px;
      }

      button#play-button {
        font-size: 18px;
        padding: 12px 30px;
      }
    }
  </style>
</head>
<body>
  <div class="game">
    <div class="scoreboard">
      <div>Score: <span id="score">0</span></div>
      <div>Best Score: <span id="best-score">0</span></div>
    </div>
    <div class="canvas-holder">
      <canvas id="canvas" width="600" height="600" tabindex="0"></canvas>
    </div>

    <div class="extra-screen" id="load-title">
      <h1>Block Blaster</h1>
      <p>
        Move the player with mouse/touch or arrow keys.<br>
        Shoot with automatic bullets.<br>
        Don't let the orange blocks reach the ground.<br>
        Destroy blocks to get points.<br>
        Blocks speed up as you score more.
      </p>
      <button id="play-button">Play</button>
    </div>

    <div class="extra-screen hide" id="lose-title">
      <h1>Game Over :(</h1>
      <p>Your Score: <span id="final-score">0</span></p>
      <p>Press Play to try again!</p>
      <button id="restart-button">Play Again</button>
    </div>
  </div>

  <audio id="shoot-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_456c3de8d0.mp3?filename=laser-gun-6036.mp3" preload="auto"></audio>
  <audio id="hit-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_247bec814b.mp3?filename=impact-metal-114132.mp3" preload="auto"></audio>
  <audio id="lose-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c63e16ca59.mp3?filename=error-126629.mp3" preload="auto"></audio>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let gameon = false;

    // Score Handling
    let score = 0;
    let bestScore = parseInt(localStorage.getItem("score")) || 0;
    document.getElementById("best-score").innerText = bestScore;

    // Entities
    let bulletArray = [];
    let villanArray = [];

    // Player
    let player = {
      x: 0,
      y: 0,
      s: 20,
      w: 30,
      h: 30,
      l: 1,
    };

    // Sounds
    const shootSound = document.getElementById("shoot-sound");
    const hitSound = document.getElementById("hit-sound");
    const loseSound = document.getElementById("lose-sound");

    // Responsive Canvas
    function resizeCanvas() {
      canvas.width = Math.min(window.innerWidth - 20, 600);
      canvas.height = canvas.width;
      player.y = canvas.height - 70;
      player.x = canvas.width / 2 - player.w / 2;

      if (canvas.width < 500) {
        player.w = 40;
        player.h = 40;
        player.s = 8;
      } else if (canvas.width < 1024) {
        player.w = 35;
        player.h = 35;
        player.s = 12;
      } else {
        player.w = 30;
        player.h = 30;
        player.s = 20;
      }
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Pointer Controls (Desktop + Touch)
    let isDragging = false;
    canvas.addEventListener("pointerdown", (e) => {
      isDragging = true;
      const rect = canvas.getBoundingClientRect();
      const pointerX = e.clientX - rect.left;
      player.x = Math.min(Math.max(pointerX - player.w / 2, 0), canvas.width - player.w);
      if (!gameon) startGame();
    });

    canvas.addEventListener("pointermove", (e) => {
      if (!isDragging) return;
      const rect = canvas.getBoundingClientRect();
      const pointerX = e.clientX - rect.left;
      player.x = Math.min(Math.max(pointerX - player.w / 2, 0), canvas.width - player.w);
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener("pointerup", () => {
      isDragging = false;
    });

    // Keyboard Controls
    document.addEventListener("keydown", e => {
      if (!gameon && (e.key === "ArrowLeft" || e.key === "ArrowRight")) startGame();

      if (!gameon) return;

      if (e.key === "ArrowLeft") {
        player.x = Math.max(player.x - player.s, 0);
      } else if (e.key === "ArrowRight") {
        player.x = Math.min(player.x + player.s, canvas.width - player.w);
      }
    });

    // Villain class
    class Villain {
      constructor(x, y, s, speed) {
        this.x = x;
        this.y = y;
        this.s = s;
        this.speed = speed;
      }

      update() {
        this.y += this.speed;
        if (this.y + this.s >= canvas.height) {
          loseGame();
        }
      }

      draw() {
        ctx.fillStyle = "#FF5700";
        ctx.fillRect(this.x, this.y, this.s, this.s);
        // border
        ctx.strokeStyle = "#ff8243";
        ctx.lineWidth = 2;
        ctx.strokeRect(this.x, this.y, this.s, this.s);
      }
    }

    // Bullet class
    class Bullet {
      constructor(x, y, speed) {
        this.x = x;
        this.y = y;
        this.w = 5;
        this.h = 10;
        this.speed = speed;
      }

      update() {
        this.y -= this.speed;
      }

      draw() {
        ctx.fillStyle = "#0f0";
        ctx.fillRect(this.x, this.y, this.w, this.h);
        // glow effect
        ctx.shadowColor = "#0f0";
        ctx.shadowBlur = 10;
        ctx.fill();
        ctx.shadowBlur = 0;
      }
    }

    // Game variables
    let villainSpeed = 1.3;
    let spawnInterval = 1000;
    let lastSpawnTime = 0;
    let lastShootTime = 0;
    let shootInterval = 200; // shoot every 200 ms
    let animationFrameId = null;

    // Collision detection
    function checkCollision(rect1, rect2) {
      return (
        rect1.x < rect2.x + rect2.s &&
        rect1.x + rect1.w > rect2.x &&
        rect1.y < rect2.y + rect2.s &&
        rect1.y + rect1.h > rect2.y
      );
    }

    // Spawn new villain block
    function spawnVillain() {
      let size = 25 + Math.random() * 10;
      let xPos = Math.random() * (canvas.width - size);
      let speed = villainSpeed + Math.random() * 0.7;
      villanArray.push(new Villain(xPos, -size, size, speed));
    }

    // Shooting bullets automatically
    function shootBullet() {
      if (!gameon) return;
      let bulletX = player.x + player.w / 2 - 2.5;
      let bulletY = player.y;
      bulletArray.push(new Bullet(bulletX, bulletY, 10));
      shootSound.currentTime = 0;
      shootSound.play();
    }

    // Update game state
    function update(time = 0) {
      if (!gameon) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Spawn villains periodically
      if (time - lastSpawnTime > spawnInterval) {
        spawnVillain();
        lastSpawnTime = time;
      }

      // Auto shooting bullets
      if (time - lastShootTime > shootInterval) {
        shootBullet();
        lastShootTime = time;
      }

      // Update and draw villains
      for (let i = villanArray.length - 1; i >= 0; i--) {
        let villain = villanArray[i];
        villain.update();
        villain.draw();

        // Remove villains that have gone past bottom (redundant safety)
        if (villain.y > canvas.height + 50) {
          villanArray.splice(i, 1);
        }
      }

      // Update and draw bullets
      for (let i = bulletArray.length - 1; i >= 0; i--) {
        let bullet = bulletArray[i];
        bullet.update();
        bullet.draw();

        // Remove bullet if out of screen
        if (bullet.y + bullet.h < 0) {
          bulletArray.splice(i, 1);
          continue;
        }

        // Check collision with villains
        for (let j = villanArray.length - 1; j >= 0; j--) {
          let villain = villanArray[j];
          if (
            bullet.x < villain.x + villain.s &&
            bullet.x + bullet.w > villain.x &&
            bullet.y < villain.y + villain.s &&
            bullet.y + bullet.h > villain.y
          ) {
            villanArray.splice(j, 1);
            bulletArray.splice(i, 1);
            score++;
            if (score > bestScore) {
              bestScore = score;
              localStorage.setItem("score", bestScore);
              document.getElementById("best-score").innerText = bestScore;
            }
            document.getElementById("score").innerText = score;

            // Play hit sound
            hitSound.currentTime = 0;
            hitSound.play();

            // Speed up villains and spawn faster every 10 points
            if (score % 10 === 0) {
              villainSpeed += 0.3;
              spawnInterval = Math.max(400, spawnInterval - 100);
              if (shootInterval > 80) {
                shootInterval -= 10;
              }
            }
            break;
          }
        }
      }

      // Draw player
      ctx.fillStyle = "#00ff00";
      ctx.shadowColor = "#00ff00";
      ctx.shadowBlur = 15;
      ctx.fillRect(player.x, player.y, player.w, player.h);
      ctx.shadowBlur = 0;

      animationFrameId = requestAnimationFrame(update);
    }

    // Lose game
    function loseGame() {
      if (!gameon) return;
      gameon = false;
      cancelAnimationFrame(animationFrameId);
      loseSound.currentTime = 0;
      loseSound.play();

      document.getElementById("final-score").innerText = score;
      document.getElementById("lose-title").classList.remove("hide");
    }

    // Start game
    function startGame() {
      // Reset all vars
      score = 0;
      villainSpeed = 1.3;
      spawnInterval = 1000;
      shootInterval = 200;
      bulletArray = [];
      villanArray = [];
      document.getElementById("score").innerText = score;

      player.x = canvas.width / 2 - player.w / 2;
      player.y = canvas.height - 70;

      document.getElementById("lose-title").classList.add("hide");
      document.getElementById("load-title").classList.add("hide");

      gameon = true;
      lastSpawnTime = 0;
      lastShootTime = 0;

      update();
    }

    // Button events
    document.getElementById("play-button").addEventListener("click", startGame);
    document.getElementById("restart-button").addEventListener("click", startGame);

    // Focus canvas for keyboard input
    canvas.setAttribute("tabindex", "0");
    canvas.focus();

  </script>
</body>
</html>
